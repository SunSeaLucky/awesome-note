---
title: VQ-VAE 与 VQ-GAN
date: 2025-11-29 14:25:00 +0800
math: true
mermaid: true
categories: [科研, 具身智能]
tags: [ebodied-ai, research]
---

今天让实验室的浩神给我讲解了一下 VQ-VAE 和 VQ-GAN。我们先来前情提要一下 VAE，他由编码器和解码器组成，编码器学习如何从图像数据 $x$ 和先验分布 $p(z)$ 学习到后验分布 $q(z|x)$，解码器则在后验分布 $q(z|x)$ 的采样 $z'$ 中解码出图像数据 $x'$。

## VQ-VAE

定义一个隐空间 $e\in \R^{K\times D}$，其中 $K$ 为离散隐空间的尺寸，$D$ 为隐向量的维度，且 $e_i\in \R^D$，$i\in~1,2,...,K$。编码器产生输出 $z_e(x)$，后验分布为：

$$
q(z=k|x)=
\begin{cases}
1 & \text{for}~k = \arg\min_j \|e_j-z_e(x)\|^2 \\
0 & \text{otherwise}
\end{cases}
$$

离散后的隐向量为：

$$
z_q(x)=e_k,~where~k=\arg\min_j \|e_j-z_e(x)\|^2
$$

损失函数为：

$$
L = \log p(x|z_q(x)) + \|\mathrm{sg}[z_e(x)] - e\|_2^2 + \beta \|z_e(x) - \mathrm{sg}[e]\|_2^2
$$

$\log p(x|z_q(x))$ 对应的是 VAE 的损失，$\|\mathrm{sg}[z_e(x)] - e\|_2^2$ 对应的是码本的损失，$\beta \|z_e(x) - \mathrm{sg}[e]\|_2^2$ 对应的是离散化的损失。

## VQ-GAN

VQ-GAN 与 VQ-VAE 类似，它将训练好的码本用于 Transformer 来生成图像。